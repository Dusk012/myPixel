<form id="form-foto-perfil" action="/usuarios/perfil" method="POST">
    <% function mostrarSaludo(session) { %>     
        <div class="saludo">
            <% if (session.login) { %>
                <!-- Foto de perfil seleccionada -->
                <div class = bordefotoperfilmostradausuario id="foto-perfil-seleccionada">
                    <img class="fotoperfilmostradausuario" 
                         src="../img/Perfil<%= session.foto_perfil || 1 %>.png?t=<%= Date.now() %>" 
                         alt="Foto de perfil">
                </div>
                <!-- Texto de bienvenida -->    
                <div>
                    <h1>Bienvenid@, <%= session.nombre %></h1>
                    <h1>username: <%= session.username %></h1>
                    <p><strong>Rol:</strong> <%= session.rol === 'A' ? 'Administrador' : 'Usuario' %></p>
                </div>
                <!-- Campos ocultos para enviar autom치ticamente el username y la foto_perfil -->
                <input type="hidden" name="username" value="<%= session.username %>">
                <input type="hidden" id="foto-perfil-input" name="foto_perfil" value="<%= session.foto_perfil %>">
                <input type="hidden" id="darse_de_baja_input" name="darse_de_baja" value="<%= session.darse_de_baja %>">
            <% } else { %>
                <p>Usuario desconocido. <a href='/usuarios/login'>Login</a></p>
            <% } %>
        </div>

        <% if (session.login) { %>
            <div class = "organizacionusuario">
                <p>游닞 Selecciona tu foto de perfil:</p>
                <div class="panelfotopefilusuario">
                    <button class = botonfotoperfilusuario type="button" onclick="seleccionarFoto('Perfil1.png')">
                        <img class = fotoperfilaelegirusuario src="../img/Perfil1.png" width="120" alt="칈cono de enlace">
                    </button>
                    <button class = botonfotoperfilusuario type="button" onclick="seleccionarFoto('Perfil2.png')">
                        <img class = fotoperfilaelegirusuario src="../img/Perfil2.png" width="120" alt="칈cono de enlace" >
                    </button>
                    <button class = botonfotoperfilusuario type="button" onclick="seleccionarFoto('Perfil3.png')">
                        <img class = fotoperfilaelegirusuario src="../img/Perfil3.png" width="120" alt="칈cono de enlace" >
                    </button>
                    <button class = botonfotoperfilusuario type="button" onclick="seleccionarFoto('Perfil4.png')">
                        <img class = fotoperfilaelegirusuario src="../img/Perfil4.png" width="120" alt="칈cono de enlace">
                    </button>
                    <button class = botonfotoperfilusuario type="button" onclick="seleccionarFoto('Perfil5.png')">
                        <img class = fotoperfilaelegirusuario src="../img/Perfil5.png" width="120" alt="칈cono de enlace">
                    </button>
                </div>
                <p id="foto-seleccionada"></p>
            </div>

            <!-- Bot칩n para enviar el formulario -->
        <div class="botonusuario">
            <button class = "botonusuariofotoperfil" type="submit">
                Guardar cambios en foto de perfil
            </button>

            <!-- Bot칩n para darse de baja -->
            <button class = "botonusuariodarsedebaja" type="button" onclick="darseDeBaja()">
                Darse de baja
            </button>
        </div>
        <% } %>
    </form>

    <!-- Incluir el archivo perfil.js -->
    <script>
        const sessionUsername = '<%= session.username %>'; // Pasar el username al script
    </script>
    <script src="perfil.js"></script>
<% } %>
    
<body>
    <!-- Llamada a la funci칩n mostrarSaludo -->
    <%= mostrarSaludo(session) %>
</body>