<section class="shop">
    <h1>Bienvenido a la Tienda</h1>

    <!-- Mostrar el mensaje flash si existe -->
    <% const flashMessage = locals.getAndClearFlash(); %>
    <% if (flashMessage) { %>
        <div class="flash-message">
            <p><%= flashMessage %></p>
        </div>
    <% } %>

    <!-- Botón para abrir el formulario de añadir producto -->
    <button id="addProductBtn">Añadir Producto</button>

    <!-- Modal para añadir producto -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span id="closeModalBtn" class="close">&times;</span>
            <h2>Añadir un nuevo producto</h2>
            <form action="/shop/add" method="POST" enctype="multipart/form-data">
                <label for="name">Nombre del producto:</label>
                <input type="text" id="name" name="name" required>

                <label for="description">Descripción:</label>
                <textarea id="description" name="description" required></textarea>

                <label for="price">Precio:</label>
                <input type="number" id="price" name="price" step="0.01" required>

                <label for="image">Imagen:</label>
                <input type="file" id="image" name="image" accept="image/*" required>

                <div id="imagePreviewContainer">
                    <img id="imagePreview" src="#" alt="Vista previa de la imagen" style="display: none;" />
                </div>
                <button type="submit">Añadir Producto</button>
            </form>
        </div>
    </div>

    <!-- Botón para ver "Mis Productos" -->
    <button id="viewMyProductsBtn">Ver Mis Productos</button>

    <!-- Lista de productos globales -->
    <h2>Productos Globales</h2>
    <% if (products && products.length > 0) { %>
        <div class="product-list">
            <% products.forEach(product => { %>
                <div class="product-card">
                    <img src="<%= product.image %>" alt="Imagen de <%= product.name %>" width="200" height="200">
                    <h3><%= product.name %></h3>
                    <p><%= product.description %></p>
                    <p><strong>Precio:</strong> €<%= product.price.toFixed(2) %></p>
                    <p><strong>Estado:</strong> <%= product.status === 'P' ? 'En venta' : 'Vendido' %></p>

                    <div class="actions">
                        <% if (product.status === 'P') { %>
                            <!-- Botón de comprar para productos globales -->
                            <form action="/shop/<%= product.id %>/buy" method="POST">
                                <button type="submit">Comprar</button>
                            </form>
                        <% } else { %>
                            <button disabled>Ya vendido</button>
                        <% } %>
                        
                        

                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <p>No hay productos de otros usuarios en este momento.</p>
    <% } %>
</section>

<!-- Agregar archivo JS -->
<script src="/js/shop.js"></script>
