<section class="shop">
    <h1>Bienvenido a la Tienda</h1>

    <!-- Mostrar el mensaje flash si existe -->
    <% const flashMessage = locals.getAndClearFlash(); %>
    <% if (flashMessage) { %>
        <div class="flash-message">
            <p><%= flashMessage %></p>
        </div>
    <% } %>

    <!-- Formulario para añadir un nuevo producto -->
    <div class="add-product-form">
        <h2>Añadir un nuevo producto</h2>
        <form action="/shop/add" method="POST" enctype="multipart/form-data">
            <label for="name">Nombre del producto:</label>
            <input type="text" id="name" name="name" required>

            <label for="description">Descripción:</label>
            <textarea id="description" name="description" required></textarea>

            <label for="price">Precio:</label>
            <input type="number" id="price" name="price" step="0.01" required>

            <label for="image">Imagen:</label>
            <input type="file" id="image" name="image" accept="image/*" required>

            <button type="submit">Añadir Producto</button>
        </form>
    </div>

    <!-- Lista de productos del usuario -->
    <h2>Mis Productos</h2>
    <% if (userProducts && userProducts.length > 0) { %>
        <div class="product-list">
            <% userProducts.forEach(product => { %>
                <div class="product-card">
                    <img src="<%= product.image %>" alt="Imagen de <%= product.name %>" width="200" height="200">
                    <h3><%= product.name %></h3>
                    <p><%= product.description %></p>
                    <p><strong>Precio:</strong> €<%= product.price.toFixed(2) %></p>
                    <p><strong>Estado:</strong> <%= product.status === 'P' ? 'En venta' : 'Vendido' %></p>

                    <div class="actions">
                        <!-- Botón para eliminar -->
                        <form action="/shop/<%= product.id %>" method="POST" onsubmit="return confirm('¿Seguro que deseas eliminar este producto?');">
                            <input type="hidden" name="_method" value="DELETE" />
                            <button type="submit">Eliminar</button>
                        </form>

                        <!-- Botón para vender -->
                        <% if (product.status === 'P') { %>
                            <!-- Formulario para vender un producto -->
                            <form action="/shop/<%= product.id %>/sell" method="POST">
                                <button type="submit">Vender</button>
                            </form>
                        <% } else { %>
                            <button disabled>Ya vendido</button>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <p>No has publicado productos aún.</p>
    <% } %>

    <!-- Lista de productos globales -->
    <h2>Productos de otros usuarios</h2>
    <% if (products && products.length > 0) { %>
        <div class="product-list">
            <% products.forEach(product => { %>
                <div class="product-card">
                    <img src="<%= product.image %>" alt="Imagen de <%= product.name %>" width="200" height="200">
                    <h3><%= product.name %></h3>
                    <p><%= product.description %></p>
                    <p><strong>Precio:</strong> €<%= product.price.toFixed(2) %></p>
                    <p><strong>Estado:</strong> <%= product.status === 'P' ? 'En venta' : 'Vendido' %></p>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <p>No hay productos de otros usuarios en este momento.</p>
    <% } %>
</section>
